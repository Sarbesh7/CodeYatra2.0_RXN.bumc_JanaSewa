import React, { useState, useEffect } from "react";
import { IoMegaphone } from "react-icons/io5";
import { FaSpinner } from "react-icons/fa";
import { useLanguage } from "../../context/LanguageContext";
import { noticesAPI } from "../../services/api";

// Default notices data with both English and Nepali content
const defaultNoticesData = [
  {
    id: 1,
    titleEn: "National Scholarship Program 2082",
    titleNp: "????????? ??????????? ????????? ????",
    descEn: "Applications open for meritorious students from marginalized communities. Apply before Baisakh 15.",
    descNp: "?????????? ???????? ?????? ??????????????? ???? ????? ???? ?? ????? ?? ??? ????? ?????????",
    category: "scholarship",
  },
  {
    id: 2,
    titleEn: "Farmer Subsidy for Khet Land",
    titleNp: "??? ?????? ???? ????? ??????",
    descEn: "Government subsidy of up to Rs 50,000 for small-scale farmers for seeds and fertilizers.",
    descNp: "???? ??????????? ??? ? ???? ???? ?? ??,??? ?????? ?????? ???????",
    category: "agriculture",
  },
  {
    id: 3,
    titleEn: "New Online Passport Application System",
    titleNp: "???? ?????? ??????? ????? ???????",
    descEn: "Department of Passports has launched a new online system effective from Magh 1.",
    descNp: "??????? ??????? ??? ? ???? ???? ???? ???? ?????? ??????? ???? ????? ??",
    category: "announcement",
  },
  {
    id: 4,
    titleEn: "Youth Self-Employment Program",
    titleNp: "???? ????????? ?????????",
    descEn: "Interest-free loans up to Rs 5 lakhs for youth entrepreneurs under PM Employment Program.",
    descNp: "????????????? ?????? ????????? ???????? ???? ???????????? ?? ? ??????? ?????????? ???",
    category: "scheme",
  },
  {
    id: 5,
    titleEn: "Free Health Camp in Rural Areas",
    titleNp: "??????? ????????? ???????? ????????? ?????",
    descEn: "Free medical checkups and medicines will be provided in select rural municipalities from Falgun 10-15.",
    descNp: "????? ??-?? ?? ???? ?????? ??????? ?????????????? ???????? ????????? ??????? ? ???? ????? ??????",
    category: "health",
  },
  {
    id: 6,
    titleEn: "Digital Literacy Training for Women",
    titleNp: "?????????? ???? ?????? ???????? ?????",
    descEn: "Registration open for free digital skills training for women above 18 years. Limited seats available.",
    descNp: "?? ???? ?????? ?????????? ???? ???????? ?????? ??? ??????? ????? ???? ?? ????? ?????? ???????",
    category: "training",
  },
];

export default function GovernmentNotices() {
  const { t, language } = useLanguage();
  const [notices, setNotices] = useState(defaultNoticesData);
  const [loading, setLoading] = useState(true);

  // Helper to get category label based on language
  const getCategoryLabel = (category) => {
    const labels = {
      scholarship: t.scholarship || "Scholarship",
      agriculture: t.agriculture || "Agriculture",
      announcement: t.announcement || "Announcement",
      scheme: t.scheme || "Scheme",
      health: t.health || "Health",
      training: t.training || "Training",
      identity: t.identity || "Identity",
    };
    return labels[category] || category;
  };

  useEffect(() => {
    const fetchNotices = async () => {
      try {
        const data = await noticesAPI.getAll();
        if (data && data.length > 0) {
          // Map API data to include both language versions if available
          const mappedData = data.map((notice, index) => ({
            id: notice.id || index + 1,
            titleEn: notice.title,
            titleNp: notice.title_np || notice.title,
            descEn: notice.description,
            descNp: notice.description_np || notice.description,
            category: notice.category?.toLowerCase() || "announcement",
          }));
          setNotices(mappedData);
        }
      } catch (error) {
        console.error("Failed to fetch notices:", error);
        // Keep default notices on error
      } finally {
        setLoading(false);
      }
    };
    fetchNotices();
  }, []);

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <FaSpinner className="animate-spin text-4xl text-blue-600" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 Container py-10">
      <h1 className="text-2xl font-semibold flex items-center gap-2">
        <span className="text-3xl"><IoMegaphone /></span>
        {t.governmentNoticesTitle}
      </h1>

      <div className="mt-6 space-y-5">
        {notices.map((notice) => (
          <div key={notice.id} className="bg-white border rounded-xl shadow-sm p-5 flex justify-between items-start">
            <div>
              <p className="text-lg font-semibold">
                {language === 'np' ? notice.titleNp : notice.titleEn}
                <span className="bg-[#1b5AA7] ml-3 text-sm rounded-2xl text-white px-2 py-1">
                  {getCategoryLabel(notice.category)}
                </span>
              </p>
              <p className="text-gray-600 mt-1">
                {language === 'np' ? notice.descNp : notice.descEn}
              </p>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
